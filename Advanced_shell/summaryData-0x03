#!/bin/bash

# Summarize Pokémon Data - Task 3
# Generates CSV report from all Pokémon JSON files

POKEMON_DATA_DIR="pokemon_data"
CSV_FILE="pokemon_report.csv"

# Check if pokemon_data directory exists
if [ ! -d "$POKEMON_DATA_DIR" ]; then
    echo "Error: $POKEMON_DATA_DIR not found. Please run the batch processing script first."
    exit 1
fi

# Create CSV header
echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

# Process each JSON file
for json_file in "$POKEMON_DATA_DIR"/*.json; do
    if [ -f "$json_file" ]; then
        # Extract data using jq
        name=$(jq -r '.name' "$json_file" | sed 's/.*/\u&/')
        height=$(jq -r '.height' "$json_file")
        weight=$(jq -r '.weight' "$json_file")
        
        # Convert units
        height_m=$(echo "$height / 10" | bc -l)
        weight_kg=$(echo "$weight / 10" | bc -l)
        
        # Add to CSV
        echo "$name,$height_m,$weight_kg" >> "$CSV_FILE"
    fi
done

echo "CSV Report generated at: $CSV_FILE"
echo ""

# Display CSV content
cat "$CSV_FILE"

echo ""

# Calculate averages using awk
echo "Average Height: $(awk -F',' 'NR>1 {sum+=$2; count++} END {printf "%.2f", sum/count}' "$CSV_FILE") m"
echo "Average Weight: $(awk -F',' 'NR>1 {sum+=$3; count++} END {printf "%.2f", sum/count}' "$CSV_FILE") kg" 